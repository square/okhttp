


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An HTTP & HTTP/2 client for Android and Java applications">
      
      
        <link rel="canonical" href="https://square.github.com/okhttp/4.x/okhttp/okhttp3/-certificate-pinner/">
      
      
        <meta name="author" content="Square, Inc.">
      
      <link rel="shortcut icon" href="../../../../images/icon-square.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.7">
    
    
      
        <title>CertificatePinner - OkHttp - OkHttp</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.b8ac9624.min.css">
      
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.28f3ef9a.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../../css/app.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="white">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#certificatepinner" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://square.github.com/okhttp/" title="OkHttp" class="md-header-nav__button md-logo" aria-label="OkHttp">
      
  <img src="../../../../images/icon-square.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            OkHttp
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              CertificatePinner - OkHttp
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/square/okhttp" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OkHttp
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://square.github.com/okhttp/" title="OkHttp" class="md-nav__button md-logo" aria-label="OkHttp">
      
  <img src="../../../../images/icon-square.png" alt="logo">

    </a>
    OkHttp
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/square/okhttp" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OkHttp
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../../.." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="https://stackoverflow.com/questions/tagged/okhttp?sort=active" title="Stack Overflow ⏏" class="md-nav__link">
      Stack Overflow ⏏
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../calls/" title="Calls" class="md-nav__link">
      Calls
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../caching/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../connections/" title="Connections" class="md-nav__link">
      Connections
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../events/" title="Events" class="md-nav__link">
      Events
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../https/" title="HTTPS" class="md-nav__link">
      HTTPS
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../interceptors/" title="Interceptors" class="md-nav__link">
      Interceptors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../recipes/" title="Recipes" class="md-nav__link">
      Recipes
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../security_providers/" title="Security Providers" class="md-nav__link">
      Security Providers
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../works_with_okhttp/" title="Works with OkHttp" class="md-nav__link">
      Works with OkHttp
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../upgrading_to_okhttp_4/" title="Upgrading to OkHttp 4" class="md-nav__link">
      Upgrading to OkHttp 4
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-14" type="checkbox" id="nav-14">
    
    <label class="md-nav__link" for="nav-14">
      4.x API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="4.x API" data-md-level="1">
      <label class="md-nav__title" for="nav-14">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        4.x API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="okhttp" class="md-nav__link">
      okhttp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-brotli/okhttp3.brotli/" title="brotli" class="md-nav__link">
      brotli
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-dnsoverhttps/okhttp3.dnsoverhttps/" title="dnsoverhttps" class="md-nav__link">
      dnsoverhttps
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-logging-interceptor/okhttp3.logging/" title="logging-interceptor" class="md-nav__link">
      logging-interceptor
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-sse/okhttp3.sse/" title="sse" class="md-nav__link">
      sse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-tls/okhttp3.tls/" title="tls" class="md-nav__link">
      tls
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../okhttp-urlconnection/okhttp3/" title="urlconnection" class="md-nav__link">
      urlconnection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../mockwebserver/okhttp3.mockwebserver/index.md" title="mockwebserver" class="md-nav__link">
      mockwebserver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-15" type="checkbox" id="nav-15">
    
    <label class="md-nav__link" for="nav-15">
      3.12.x API
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="3.12.x API" data-md-level="1">
      <label class="md-nav__title" for="nav-15">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        3.12.x API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/okhttp/" title="okhttp ⏏" class="md-nav__link">
      okhttp ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/okhttp-dnsoverhttps/" title="dnsoverhttps ⏏" class="md-nav__link">
      dnsoverhttps ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/logging-interceptor/" title="logging-interceptor ⏏" class="md-nav__link">
      logging-interceptor ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/okhttp-sse/" title="sse ⏏" class="md-nav__link">
      sse ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/okhttp-tls/" title="tls ⏏" class="md-nav__link">
      tls ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/okhttp-urlconnection/" title="urlconnection ⏏" class="md-nav__link">
      urlconnection ⏏
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://square.github.io/okhttp/3.x/mockwebserver/" title="mockwebserver ⏏" class="md-nav__link">
      mockwebserver ⏏
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../changelog/" title="Change Log" class="md-nav__link">
      Change Log
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../contributing/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../../code_of_conduct/" title="Code of Conduct" class="md-nav__link">
      Code of Conduct
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-up-certificate-pinning" class="md-nav__link">
    Setting up Certificate Pinning
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#domain-patterns" class="md-nav__link">
    Domain Patterns
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#warning-certificate-pinning-is-dangerous" class="md-nav__link">
    Warning: Certificate Pinning is Dangerous!
  </a>
  
    <nav class="md-nav" aria-label="Warning: Certificate Pinning is Dangerous!">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#note-about-self-signed-certificates" class="md-nav__link">
    Note about self-signed certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types" class="md-nav__link">
    Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#properties" class="md-nav__link">
    Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#companion-object-properties" class="md-nav__link">
    Companion Object Properties
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#companion-object-functions" class="md-nav__link">
    Companion Object Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <p><a href="../../">okhttp</a> / <a href="../">okhttp3</a> / <a href="./">CertificatePinner</a></p>
<h1 id="certificatepinner">CertificatePinner<a class="headerlink" href="#certificatepinner" title="Permanent link">&para;</a></h1>
<p><code>class CertificatePinner</code></p>
<p>Constrains which certificates are trusted. Pinning certificates defends against attacks on
certificate authorities. It also prevents connections through man-in-the-middle certificate
authorities either known or unknown to the application&rsquo;s user.
This class currently pins a certificate&rsquo;s Subject Public Key Info as described on
<a href="http://goo.gl/AIx3e5">Adam Langley&rsquo;s Weblog</a>. Pins are either base64 SHA-256 hashes as in
<a href="http://tools.ietf.org/html/rfc7469">HTTP Public Key Pinning (HPKP)</a> or SHA-1 base64 hashes as in Chromium&rsquo;s
<a href="http://goo.gl/XDh6je">static certificates</a>.</p>
<h2 id="setting-up-certificate-pinning">Setting up Certificate Pinning<a class="headerlink" href="#setting-up-certificate-pinning" title="Permanent link">&para;</a></h2>
<p>The easiest way to pin a host is turn on pinning with a broken configuration and read the
expected configuration when the connection fails. Be sure to do this on a trusted network, and
without man-in-the-middle tools like <a href="http://charlesproxy.com">Charles</a> or <a href="http://fiddlertool.com">Fiddler</a>.</p>
<p>For example, to pin <code>https://publicobject.com</code>, start with a broken configuration:</p>
<div class="highlight"><pre><span></span><code>String hostname = &quot;publicobject.com&quot;;
CertificatePinner certificatePinner = new CertificatePinner.Builder()
    .add(hostname, &quot;sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=&quot;)
    .build();
OkHttpClient client = OkHttpClient.Builder()
    .certificatePinner(certificatePinner)
    .build();

Request request = new Request.Builder()
    .url(&quot;https://&quot; + hostname)
    .build();
client.newCall(request).execute();
</code></pre></div>

<p>As expected, this fails with a certificate pinning exception:</p>
<div class="highlight"><pre><span></span><code>javax.net.ssl.SSLPeerUnverifiedException: Certificate pinning failure!
Peer certificate chain:
    sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=: CN=publicobject.com, OU=PositiveSSL
    sha256/klO23nT2ehFDXCfx3eHTDRESMz3asj1muO+4aIdjiuY=: CN=COMODO RSA Secure Server CA
    sha256/grX4Ta9HpZx6tSHkmCrvpApTQGo67CYDnvprLg5yRME=: CN=COMODO RSA Certification Authority
    sha256/lCppFqbkrlJ3EcVFAkeip0+44VaoJUymbnOaEUk7tEU=: CN=AddTrust External CA Root
Pinned certificates for publicobject.com:
    sha256/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=
  at okhttp3.CertificatePinner.check(CertificatePinner.java)
  at okhttp3.Connection.upgradeToTls(Connection.java)
  at okhttp3.Connection.connect(Connection.java)
  at okhttp3.Connection.connectAndSetOwner(Connection.java)
</code></pre></div>

<p>Follow up by pasting the public key hashes from the exception into the
certificate pinner&rsquo;s configuration:</p>
<div class="highlight"><pre><span></span><code>CertificatePinner certificatePinner = new CertificatePinner.Builder()
    .add(&quot;publicobject.com&quot;, &quot;sha256/afwiKY3RxoMmLkuRW1l7QsPZTJPwDS2pdDROQjXw8ig=&quot;)
    .add(&quot;publicobject.com&quot;, &quot;sha256/klO23nT2ehFDXCfx3eHTDRESMz3asj1muO+4aIdjiuY=&quot;)
    .add(&quot;publicobject.com&quot;, &quot;sha256/grX4Ta9HpZx6tSHkmCrvpApTQGo67CYDnvprLg5yRME=&quot;)
    .add(&quot;publicobject.com&quot;, &quot;sha256/lCppFqbkrlJ3EcVFAkeip0+44VaoJUymbnOaEUk7tEU=&quot;)
    .build();
</code></pre></div>

<h2 id="domain-patterns">Domain Patterns<a class="headerlink" href="#domain-patterns" title="Permanent link">&para;</a></h2>
<p>Pinning is per-hostname and/or per-wildcard pattern. To pin both <code>publicobject.com</code> and
<code>www.publicobject.com</code> you must configure both hostnames. Or you may use patterns to match
sets of related domain names. The following forms are permitted:</p>
<ul>
<li>
<p><strong>Full domain name</strong>: you may pin an exact domain name like <code>www.publicobject.com</code>. It won&rsquo;t
    match additional prefixes (<code>us-west.www.publicobject.com</code>) or suffixes (<code>publicobject.com</code>).</p>
</li>
<li>
<p><strong>Any number of subdomains</strong>: Use two asterisks to like <code>**.publicobject.com</code> to match any
    number of prefixes (<code>us-west.www.publicobject.com</code>, <code>www.publicobject.com</code>) including no
    prefix at all (<code>publicobject.com</code>). For most applications this is the best way to configure
    certificate pinning.</p>
</li>
<li>
<p><strong>Exactly one subdomain</strong>: Use a single asterisk like <code>*.publicobject.com</code> to match exactly
    one prefix (<code>www.publicobject.com</code>, <code>api.publicobject.com</code>). Be careful with this approach as
    no pinning will be enforced if additional prefixes are present, or if no prefixes are present.</p>
</li>
</ul>
<p>Note that any other form is unsupported. You may not use asterisks in any position other than
the leftmost label.</p>
<p>If multiple patterns match a hostname, any match is sufficient. For example, suppose pin A
applies to <code>*.publicobject.com</code> and pin B applies to <code>api.publicobject.com</code>. Handshakes for
<code>api.publicobject.com</code> are valid if either A&rsquo;s or B&rsquo;s certificate is in the chain.</p>
<h2 id="warning-certificate-pinning-is-dangerous">Warning: Certificate Pinning is Dangerous!<a class="headerlink" href="#warning-certificate-pinning-is-dangerous" title="Permanent link">&para;</a></h2>
<p>Pinning certificates limits your server team&rsquo;s abilities to update their TLS certificates. By
pinning certificates, you take on additional operational complexity and limit your ability to
migrate between certificate authorities. Do not use certificate pinning without the blessing of
your server&rsquo;s TLS administrator!</p>
<h3 id="note-about-self-signed-certificates">Note about self-signed certificates<a class="headerlink" href="#note-about-self-signed-certificates" title="Permanent link">&para;</a></h3>
<p><a href="./">CertificatePinner</a> can not be used to pin self-signed certificate if such certificate is not
accepted by <a href="https://docs.oracle.com/javase/8/docs/api/javax/net/ssl/TrustManager.html">javax.net.ssl.TrustManager</a>.</p>
<p>See also <a href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning">OWASP: Certificate and Public Key Pinning</a>.</p>
<h3 id="types">Types<a class="headerlink" href="#types" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="-builder/">Builder</a></td>
<td>Builds a configured certificate pinner.<code>class Builder</code></td>
</tr>
<tr>
<td><a href="-pin/">Pin</a></td>
<td>A hostname pattern and certificate hash for Certificate Pinning.<code>class Pin</code></td>
</tr>
</tbody>
</table>
<h3 id="properties">Properties<a class="headerlink" href="#properties" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="pins/">pins</a></td>
<td><code>val pins:</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-set/index.html"><code>Set</code></a><code>&lt;Pin&gt;</code></td>
</tr>
</tbody>
</table>
<h3 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="check/">check</a></td>
<td>Confirms that at least one of the certificates pinned for <code>hostname</code> is in <code>peerCertificates</code>. Does nothing if there are no certificates pinned for <code>hostname</code>. OkHttp calls this after a successful TLS handshake, but before the connection is used.<code>fun check(hostname:</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html"><code>String</code></a><code>, peerCertificates:</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html"><code>List</code></a><code>&lt;</code><a href="https://docs.oracle.com/javase/8/docs/api/java/security/cert/Certificate.html"><code>Certificate</code></a><code>&gt;):</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-unit/index.html"><code>Unit</code></a></td>
</tr>
<tr>
<td><a href="equals/">equals</a></td>
<td><code>fun equals(other:</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-any/index.html"><code>Any</code></a><code>?):</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-boolean/index.html"><code>Boolean</code></a></td>
</tr>
<tr>
<td><a href="find-matching-pins/">findMatchingPins</a></td>
<td>Returns list of matching certificates&rsquo; pins for the hostname. Returns an empty list if the hostname does not have pinned certificates.<code>fun findMatchingPins(hostname:</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html"><code>String</code></a><code>):</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/-list/index.html"><code>List</code></a><code>&lt;Pin&gt;</code></td>
</tr>
<tr>
<td><a href="hash-code/">hashCode</a></td>
<td><code>fun hashCode():</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-int/index.html"><code>Int</code></a></td>
</tr>
</tbody>
</table>
<h3 id="companion-object-properties">Companion Object Properties<a class="headerlink" href="#companion-object-properties" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="-d-e-f-a-u-l-t/">DEFAULT</a></td>
<td><code>val DEFAULT:</code><a href="./"><code>CertificatePinner</code></a></td>
</tr>
</tbody>
</table>
<h3 id="companion-object-functions">Companion Object Functions<a class="headerlink" href="#companion-object-functions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Summary</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="pin/">pin</a></td>
<td>Returns the SHA-256 of <code>certificate</code>&lsquo;s public key.<code>fun pin(certificate:</code><a href="https://docs.oracle.com/javase/8/docs/api/java/security/cert/Certificate.html"><code>Certificate</code></a><code>):</code><a href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin/-string/index.html"><code>String</code></a></td>
</tr>
<tr>
<td><a href="sha1-hash/">sha1Hash</a></td>
<td><code>fun</code><a href="https://docs.oracle.com/javase/8/docs/api/java/security/cert/X509Certificate.html"><code>X509Certificate</code></a><code>.sha1Hash():</code><a href="https://square.github.io/okio/2.x/okio/okio/-byte-string/index.html"><code>ByteString</code></a></td>
</tr>
<tr>
<td><a href="sha256-hash/">sha256Hash</a></td>
<td><code>fun</code><a href="https://docs.oracle.com/javase/8/docs/api/java/security/cert/X509Certificate.html"><code>X509Certificate</code></a><code>.sha256Hash():</code><a href="https://square.github.io/okio/2.x/okio/okio/-byte-string/index.html"><code>ByteString</code></a></td>
</tr>
</tbody>
</table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Square, Inc.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../../assets/javascripts/vendor.d1f5a259.min.js"></script>
      <script src="../../../../assets/javascripts/bundle.d5fec882.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../../..",
          features: [],
          search: Object.assign({
            worker: "../../../../assets/javascripts/worker/search.fae956e7.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>